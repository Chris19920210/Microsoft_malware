import os
from csv import writer
import nltk
import itertools
import pandas as pd
import pickle
paths = '/media/chris/Elements/test'

f = open('/media/chris/Elements/2gram_final_count.p', 'r')

two_gram = pickle.load(f)

colname = pd.read_csv('/media/chris/Elements/finaldata_Microsoft_train/importances_feature_2gram_count.csv')

colname = list(colname.loc[1:, 'Id'])


def consolidate(path):
    s_path = path
    Files = os.listdir(s_path)
    byteFiles = [i for i in Files if '.bytes' in i]
    consolidatedFile = s_path + '_2gramfrequency.csv'
    with open(consolidatedFile, 'w') as f:
        fw = writer(f)
        colnames = ['Id']
        colnames += colname
        fw.writerow(colnames)
        for t, fname in enumerate(byteFiles):
            consolidation = []
            f = open(s_path + '/' + fname, 'rU')
            raw = f.read().split()
            raw2 = nltk.bigrams(raw)
            freq = nltk.FreqDist(raw2)
            hexByte = [0]*len(two_gram)
            for i in range(len(two_gram)):
                hexByte[i] = freq[two_gram[i]]
            consolidation += [fname[:fname.find('.bytes')]]
            consolidation += hexByte
            fw.writerow(consolidation)

if __name__ == '__main__':
    consolidate(paths)
    print("DONE 2-gram-bytes count!")
